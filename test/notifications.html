<html>
<head>
    <title>Notifications</title>

    <script src="http://code.jquery.com/jquery-1.5.2.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function() {
            template = $('.template');

            $('form').submit(function() {
                var data = {
                    type: $('select[name=type]').val(),
                    description: {
                        title: $('input[name=title]').val(),
                        teaser: $('input[name=teaser]').val()
                    },
                    casters: {
                        caster: $('input[name=caster]').val()
                    },
                    link: {
                        url: $('input[name=url]').val()
                    }
                };
                $.ajax({
                    type: 'POST',
                    url: '/notifications',
                    data: JSON.stringify(data)
                });
                return false;
            });
        });
    </script>
    <script src="http://cdn.sockjs.org/sockjs-0.3.js"></script>
    <script>
        nodeConfig = ['http://node.sc2tv.ru:60065'];
    </script>
    <script src="chatterbird.js" type="text/javascript"></script>
    <script type="text/javascript">
        var socket = new Chatterbird('notifications');

        socket.onmessage = function(message) {
            var elem = $(template.clone());

            elem.children('.title').text(message.description.title);
            $('#notifications').prepend(elem);
        };
    </script>
</head>
<body>
    <p class="template">
        <span class="title"></span>
        <span class="casters"></span>
        <span class="link"></span>
    </p>

    <form action="/notify">
        Type:
        <select name="type">
            <option value="stream">Stream</option>
            <option value="userstream">Userstream</option>
            <option value="realstream">Realstream</option>
            <option value="important">Important</option>
        </select>
        <br/>
        Title: <input type="text" name="title" />
        <br/>
        Teaser: <input type="text" name="teaser" />
        <br/>
        Caster: <input type="text" name="caster"/>
        <br/>
        Link: <input type="text" name="url"/>

        <input type="submit"/>
    </form>

    <hr/>

    <div id="notifications"></div>
</body>
</html>
